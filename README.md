# s2member-payment-data Python Scripts

A bunch of small Python scripts allowing you to extract and post process the data from the Transactional Payments Emails created by the WordPress plugin S2member.  

They play nicely together and with all three scripts you can get a Telegram notification about yesterday's number of transactions and total income generated with S2member from your WordPress Membership Website.

1. Install dependencies with pip install -r requirements.txt

2. Rename env.txt to .env and fill in your Email Server's credentials and Telegram Bot Token and Chat ID.
   

## s2email2csv.py

Python script to extract the fields from an S2Member transaction Email regarding payments from Paypal and store them in a local output.csv for further use.

3. Script will gather all S2Member transactional Emails from INBOX, extract Information and store it in a local output.csv
 
4. Every time the script is run, it creates additional lines to the output.csv (if new emails are found).

5. The output.csv file can be used as a ledger for all transactions an post-processed further.


## s2yesterdaysmessage.py

Python script to read from the previously generated output.csv to generate a message about yesterday's number of transactions and total income.

6. Script will read from output.csv file which needs to be generated by s2email2csv.py before and have the proper columns.

7. When the script is run it will generate a previous_day_message.txt in the following format: "On Sun, 11 Jun 2023, there were 4 transactions with a total income of USD 60.00."

8. When the script is run again at a later point, it will overwrit ethe previous_day_message.txt

9. The content of previous_day_message.txt can be used to submit the message in various ways (e.g. through a Telegram Bot).


## s2ymsgtelegram.py

Python script that sends the previous_day_message.txt generated by s2yesterdaysmessage.py via your Telegram Bot.

10. Script will send the content of the previous_day_message.txt via Telegram.


## Automation 

You can automate the scripts to run one after the other with a cronjob.

Example:

- On your command line run crontab -e
- Make sure each script is executable: chmod +x /path/to/script.py
- Add entry for each script with short delays to start with the first one at 19:35 each each evening and creating a log for each script:
 
### Example Entry crontab
35 19 * * * cd /home/usr/projects/s2payments && /home/usr/projects/s2payments/env/bin/python3 /home/usr/projects/s2payments/s2member-payment-data/s2email2csv.py

To find out the path path to your Python virtual environment use: which python when virtual env is active.


## Todos

- Delete emails that have been processed after xx days in s2email2csv.py 

